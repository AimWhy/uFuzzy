// https://github.com/localvoid/ndx v2.0.1
var ndx=function(e){"use strict";const t=Int32Array,n=Float64Array,o=Map,l=Object.seal({found:!1,i:0}),r=(e,t)=>{const n=l;let o=0,r=e.length;for(;o<r;){const l=o+r>>1,s=e[l].k-t;if(s<0)o=l+1;else{if(!(s>0))return n.found=!0,void(n.i=l);r=l}}n.found=!1,n.i=o},s=e=>({k:e,c:null,d:null}),d=(e,t)=>{const n=l;let o=0;for(;void 0!==e&&o<t.length;){const l=e.c;if(null===l)return;if(r(l,t.charCodeAt(o++)),!1===n.found)return;e=l[n.i]}return e};function i(e){let t=0,n=0;const o=e.d,l=e.c;if(null!==o){for(;t<o.length;){!0!==o[t].details.removed?t++:(o.length>1&&(o[t]=o[o.length-1]),o.pop())}o.length>0&&(n=1)}if(null!==l)for(t=0;t<l.length;){const e=i(l[t]);n|=e,0===e?l.splice(t,1):t++}return n}const c=(e,t)=>t.score-e.score,f=Math.max,u=Math.log,h=String.fromCharCode,g=(e,t,n)=>{null!==e.d&&t.push(n);const o=e.c;if(null!==o)for(let e=0;e<o.length;e++){const l=o[e];g(l,t,n+h(l.k))}},a=(e,t)=>{const n=d(e.root,t),o=[];return void 0!==n&&g(n,o,t),o};return e.createIndex=(e,t,l)=>({docs:new o,root:s(0),fSum:new n(e),fAvg:new n(e),removed:0,tokenizer:t,filter:l}),e.expandTerm=a,e.findInvertedIndexNode=d,e.indexAdd=(e,n,d,i)=>{const{root:c,fSum:f,fAvg:u,docs:h,tokenizer:g,filter:a}=e,v=new o,m=new t(n.length);for(let e=0;e<n.length;e++){const o=n[e](i);if(void 0!==o){const n=g(o);let l=0;for(let o=0;o<n.length;o++){const r=a(n[o]);if(""!==r){l++;let n=v.get(r);void 0===n&&(n=new t(f.length),v.set(r,n)),n[e]+=1}}f[e]+=l,u[e]=f[e]/(h.size+1),m[e]=l}}const p={key:d,fCount:m,removed:!1};h.set(d,p),v.forEach(((e,t)=>{const n=l;let o=c;for(let e=0;e<t.length;e++){const l=t.charCodeAt(e);let d;null!==o.c?(r(o.c,l),!1===n.found?(d=s(l),o.c.splice(n.i,0,d),o=d):o=o.c[n.i]):(d=s(l),o.c=[d],o=d)}const d={details:p,tf:e};null===o.d?o.d=[d]:o.d.push(d)}))},e.indexQuery=(e,t,n,o,l)=>{const{docs:r,root:s,fAvg:i,tokenizer:h,filter:g}=e,v=h(l),m=new Map;for(let l=0;l<v.length;l++){const c=g(v[l]);if(""!==c){const l=a(e,c),h=new Set;for(let e=0;e<l.length;e++){const g=l[e],a=g===c?1:u(1+1/(1+g.length-c.length)),v=d(s,g);let p;if(void 0!==v&&null!==(p=v.d)){let e=0;for(let t=0;t<p.length;t++){!1===p[t].details.removed&&e++}if(e>0){const l=u(1+(r.size-e+.5)/(e+.5));for(let e=0;e<p.length;e++){const r=p[e];if(!1===r.details.removed){let e=0;for(let s=0;s<r.details.fCount.length;s++){let d=r.tf[s];if(d>0){d=(n+1)*d/(n*(1-o+o*(r.details.fCount[s]/i[s]))+d),e+=d*l*t[s]*a}}if(e>0){const t=r.details.key,n=m.get(t);m.set(t,void 0!==n&&h.has(t)?f(n,e):void 0===n?e:n+e),h.add(t)}}}}}}}}const p=[];return m.forEach(((e,t)=>{p.push({key:t,score:e})})),p.sort(c),p},e.indexRemove=(e,t)=>{const{docs:n,fSum:o,fAvg:l}=e,r=n.get(t);if(void 0!==r){e.removed++,r.removed=!0,n.delete(t);for(let e=0;e<o.length;e++){const t=r.fCount[e];t>0&&(o[e]-=t,l[e]=o[e]/n.size)}}},e.indexVacuum=function(e){i(e.root),e.removed=0},e}({});
